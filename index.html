<!DOCTYPE html>
<html>
<head>
    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="css/build.css" rel="stylesheet" type="text/css" />
    <link href="css/github.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="page">
    <header class="masthead">
        <h1><a href="/">Father. Husband. Developer. All Around Geek!</a></h1>
        <ul class="sociallist">
            <li><a class="icon-linkedin" href="https://linkedin.com/in/larkmullins">LinkedIn</a></li>
            <li><a class="icon-github" href="https://github.com/larkmullins">Github</a></li>
            <li><a class="icon-bitbucket" href="https://bitbucket.org/larkmullins">Bitbucket</a></li>
            <li><a class="icon-twitter" href="https://twitter.com/larkmullins">Twitter</a></li>
            <li><a class="icon-googleplus" href="https://plus.google.com/+LarkMullins">Google+</a></li>
            <li><a class="icon-coderwall" href="https://coderwall.com/larkmullins">CoderWall</a></li>
        </ul>
    </header>
    <div class="main"></div>
</div>
<script src="js/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="js/showdown.js" type="text/javascript"></script>
<script src="js/highlight.pack.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    
    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    
    //var hash = window.location.hash;

    $.getJSON('https://api.github.com/users/larkmullins/gists', function(data) {}).done(function(data) {
        if($.isEmptyObject(data)) {
            $('.main').append('No posts found. Please check back later.');
            return;
        }

        $.each(data, function(i, item) {
            if(item.description.match('^POST\: ')) {
                $('.main').append(buildPostHeader(item));
            }
            
            $('.post__title a').on('click', function(event) {
                event.preventDefault();
                var id = $(this).attr('href').replace('#', '');
                getPost(id);
            });
        });
    }).fail(function() {
        $('.main').append('Uh-Oh! Something has happened. I am unable to display any posts.');
    });
    
    function getPost(id) {
        $.getJSON('https://api.github.com/gists/' + id, function(data) {
            var header  = buildPostHeader(data);
            var title   = data.description.replace('POST: ', '');
            
            // get file name
            for(var prop in data.files) {
                var file = prop;
                break;
            }
            
            // get content, convert Markdown, and replace .main content
            var content = data.files[file].content;
            var converter = new Showdown.converter();
            var html = converter.makeHtml(content);
            $('.main').html(header + html);
        }).done(function() {
            $('pre code').each(function(i, block) {
                hljs.highlightBlock(block);
            });
        });
    }
    
    function buildPostHeader(obj) {
        var id    = obj.id;
        var title = obj.description.replace('POST: ', '');
        
        // format date
        var date  = new Date(obj.updated_at);
        var day   = date.getDate();
        var month = months[date.getMonth()];
        var year  = date.getFullYear();
        var fdate = month + ' ' + day + ', ' + year;
        
        return '<article class="post"><header class="post__header"><h2 class="post__title"><a href="#' + id + '">' + title +'</a></h2><p class="post__meta">' + fdate + '</p></header><article>';
    }
    
});
</script>
</body>
</html>